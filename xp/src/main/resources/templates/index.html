<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–æ–∏ –∑–∞–¥–∞—á–∏</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .task-card {
            transition: all 0.3s ease;
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .status-badge {
            font-size: 0.85rem;
            padding: 0.4rem 0.8rem;
        }
        .deadline-text {
            font-size: 0.9rem;
        }
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #ddd;
        }
        .task-item:last-child {
            border-bottom: none;
        }
        .btn-edit {
            background-color: #007bff;
            color: white;
            padding: 0.375rem 0.75rem;
            border: none;
            border-radius: 0.375rem;
            text-decoration: none;
        }
        .btn-delete {
            background-color: #dc3545;
            color: white;
            padding: 0.375rem 0.75rem;
            border: none;
            border-radius: 0.375rem;
            text-decoration: none;
        }
    </style>
</head>
<body class="bg-light">
<nav class="navbar navbar-light bg-white shadow-sm mb-4">
    <div class="container">
        <span class="navbar-brand mb-0 h1">üìù ListFlow</span>
        <div>
            <span class="me-3">–ü—Ä–∏–≤–µ—Ç, <strong th:text="${username}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</strong>!</span>
            <a href="/logout" class="btn btn-sm btn-outline-secondary">–í—ã–π—Ç–∏</a>
        </div>
    </div>
</nav>

<div class="container" style="max-width: 800px;">
    <h2 class="mb-4">–ú–æ–∏ –∑–∞–¥–∞—á–∏</h2>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h5>
            <form th:action="@{/tasks/add}" th:object="${newTask}" method="post">
                <div class="row g-3">
                    <div class="col-md-6">
                        <input type="text" class="form-control" th:field="*{title}"
                               placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" required>
                    </div>
                    <div class="col-md-3">
                        <input type="date" class="form-control" th:field="*{deadline}"
                               placeholder="–î–µ–¥–ª–∞–π–Ω (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-primary w-100">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
    <div th:if="${tasks.isEmpty()}" class="text-center text-muted py-5">
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</p>
    </div>

    <div th:each="task : ${tasks}" class="task-item">
        <span th:text="${task.title}">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</span>
        <span th:if="${task.deadline != null}">
            <span th:if="${task.deadline.isBefore(T(java.time.LocalDate).now())}" 
                  style="color: red; font-weight: bold;">
                –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ (–¥–æ <span th:text="${task.deadline}"></span>)
            </span>
            <span th:unless="${task.deadline.isBefore(T(java.time.LocalDate).now())}" 
                  th:text="'–¥–æ ' + ${task.deadline}"></span>
        </span>
        <div class="d-flex gap-2 align-items-center">
            <!-- –°—Ç–∞—Ç—É—Å -->
            <form th:action="@{/tasks/{id}/status(id=${task.id})}" method="post" class="d-inline">
                <select name="status" class="form-select form-select-sm status-badge"
                        th:classappend="${task.status.name() == 'COMPLETED' ? 'bg-success text-white' : (task.status.name() == 'IN_PROGRESS' ? 'bg-warning' : 'bg-secondary text-white')}"
                        onchange="this.form.submit()">
                    <option th:each="status : ${statuses}"
                            th:value="${status.name()}"
                            th:text="${status.displayName}"
                            th:selected="${status == task.status}">
                    </option>
                </select>
            </form>

            <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
            <a th:href="@{/task/edit/{id}(id=${task.id})}" class="btn btn-edit">
                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </a>

            <!-- –£–¥–∞–ª–∏—Ç—å -->
            <form th:action="@{/tasks/{id}/delete(id=${task.id})}" method="post" class="d-inline">
                <button type="submit" class="btn btn-sm btn-outline-danger"
                        onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')">
                    üóëÔ∏è
                </button>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
